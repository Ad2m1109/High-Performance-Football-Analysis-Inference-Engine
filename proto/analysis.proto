syntax = "proto3";

package analysis;

service AnalysisEngine {
  // Analyzes a video and returns a stream of progress updates and final results.
  rpc AnalyzeVideo(VideoRequest) returns (stream VideoResponse);
}

message VideoRequest {
  string video_path = 1;
  string calibration_path = 2;
  float confidence_threshold = 3;
  string match_id = 4;
}

message VideoResponse {
  string job_id = 1;
  string status = 2; // PENDING, PROCESSING, COMPLETED, FAILED
  float progress = 3; // 0.0 to 1.0
  string message = 4;
  
  // Final results (only populated when status is COMPLETED)
  AnalysisResult result = 5;
}

message AnalysisResult {
  string match_id = 1;
  int32 total_frames = 2;
  int32 players_tracked = 3;
  string report_id = 4;
  string player_metrics_csv_path = 5;
  string ball_metrics_csv_path = 6;
}
